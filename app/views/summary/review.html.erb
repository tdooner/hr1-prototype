<div class="grid-row">
  <div class="grid-col-12 usa-prose">
    <h1>Review Your Information</h1>
    
    <p>
      Check all your responses below to make sure they are correct. You can edit any section by clicking the "Edit" link next to it.
    </p>
    <p>
      Once you're satisfied with your answers, click "Submit Form" to complete the process.
    </p>
    
    <div class="usa-summary-box">
      <div class="usa-summary-box__body">
        <h3 class="usa-summary-box__heading">
          Basic Information
          <%= link_to "Edit", edit_engagement_form_path(@engagement_form), class: "usa-button usa-button--small usa-button--outline", style: "float: right;" %>
        </h3>
        <div class="usa-summary-box__text">
          <p><strong>Name:</strong> <%= @engagement_form.user_name %></p>
          <p><strong>Email:</strong> <%= @engagement_form.email %></p>
  
        </div>
      </div>
    </div>
    
    <div class="usa-summary-box">
      <div class="usa-summary-box__body">
        <h3 class="usa-summary-box__heading">
          Engagement Activities
          <%= link_to "Edit", new_engagement_form_question_path(@engagement_form, from_review: true), class: "usa-button usa-button--small usa-button--outline", style: "float: right;" %>
        </h3>
        <div class="usa-summary-box__text">
          <ul class="usa-list">
            <li><%= @engagement_form.has_job? ? "✅ I have a job" : "❌ I don't have a job" %></li>
            <li><%= @engagement_form.is_student? ? "✅ I am a student" : "❌ I am not a student" %></li>
            <li><%= @engagement_form.enrolled_work_program? ? "✅ I am enrolled in a work program" : "❌ I am not enrolled in a work program" %></li>
            <li><%= @engagement_form.volunteers_nonprofit? ? "✅ I volunteer with a nonprofit organization" : "❌ I don't volunteer with a nonprofit organization" %></li>
          </ul>
        </div>
      </div>
    </div>
    
    <% if @engagement_form.has_job? %>
      <div class="usa-summary-box">
        <div class="usa-summary-box__body">
          <h3 class="usa-summary-box__heading">
            Employment Details
            <%= link_to "Edit", new_engagement_form_job_path(@engagement_form, from_review: true), class: "usa-button usa-button--small usa-button--outline", style: "float: right;" %>
          </h3>
          <div class="usa-summary-box__text">
            <% if @engagement_form.job_paychecks.any? %>
              <div class="usa-table-container--scrollable" tabindex="0">
                <table class="usa-table">
                  <thead>
                    <tr>
                      <th scope="col">Pay Date</th>
                      <th scope="col">Gross Pay</th>
                      <th scope="col">Hours</th>
                    </tr>
                  </thead>
                  <tbody>
                    <% @engagement_form.job_paychecks.ordered_by_date.each do |paycheck| %>
                      <tr>
                        <td><%= paycheck.pay_date.strftime("%B %d, %Y") %></td>
                        <td>$<%= number_with_precision(paycheck.gross_pay_amount, precision: 2) %></td>
                        <td><%= paycheck.hours_worked %></td>
                      </tr>
                    <% end %>
                  </tbody>
                </table>
              </div>
              <p><strong>Total Hours:</strong> <%= @engagement_form.job_paychecks.sum(&:hours_worked) %></p>
              <p><strong>Total Gross Pay:</strong> $<%= number_with_precision(@engagement_form.job_paychecks.sum(&:gross_pay_amount), precision: 2) %></p>
            <% else %>
              <p>No paychecks have been added yet.</p>
            <% end %>
          </div>
        </div>
      </div>
    <% end %>
    
    <% if @engagement_form.is_student? %>
      <div class="usa-summary-box">
        <div class="usa-summary-box__body">
          <h3 class="usa-summary-box__heading">
            Student Details
            <%= link_to "Edit", new_engagement_form_student_path(@engagement_form, from_review: true), class: "usa-button usa-button--small usa-button--outline", style: "float: right;" %>
          </h3>
          <div class="usa-summary-box__text">
            <% if @engagement_form.school_name.present? %>
              <p><strong>School:</strong> <%= @engagement_form.school_name %></p>
            <% end %>
            <% if @engagement_form.enrollment_status == "half_time_or_more" %>
              <p><strong>Enrollment Status:</strong> Enrolled at least half-time</p>
            <% elsif @engagement_form.enrollment_status == "less_than_half_time" %>
              <p><strong>Enrollment Status:</strong> Enrolled less than half-time</p>
              <% if @engagement_form.school_hours.present? %>
                <p><strong>School Hours per Week:</strong> <%= @engagement_form.school_hours %> hours</p>
              <% end %>
            <% end %>
          </div>
        </div>
      </div>
    <% end %>
    
    <% if @engagement_form.enrolled_work_program? %>
      <div class="usa-summary-box">
        <div class="usa-summary-box__body">
          <h3 class="usa-summary-box__heading">
            Work Program Details
            <%= link_to "Edit", new_engagement_form_work_program_path(@engagement_form, from_review: true), class: "usa-button usa-button--small usa-button--outline", style: "float: right;" %>
          </h3>
          <div class="usa-summary-box__text">
            <% if @engagement_form.work_program_name.present? %>
              <p><strong>Work Program Name:</strong> <%= @engagement_form.work_program_name %></p>
            <% end %>
            <% if @engagement_form.hours_attended.present? %>
              <p><strong>Hours Attended:</strong> <%= @engagement_form.hours_attended %> hours</p>
            <% end %>
          </div>
        </div>
      </div>
    <% end %>
    
    <% if @engagement_form.volunteers_nonprofit? %>
      <div class="usa-summary-box">
        <div class="usa-summary-box__body">
          <h3 class="usa-summary-box__heading">
            Volunteer Hours
            <%= link_to "Edit", new_engagement_form_volunteer_path(@engagement_form, from_review: true), class: "usa-button usa-button--small usa-button--outline", style: "float: right;" %>
          </h3>
          <div class="usa-summary-box__text">
            <% if @engagement_form.volunteer_shifts.any? %>
              <div class="usa-table-container--scrollable" tabindex="0">
                <table class="usa-table">
                  <thead>
                    <tr>
                      <th scope="col">Organization</th>
                      <th scope="col">Date</th>
                      <th scope="col">Hours</th>
                    </tr>
                  </thead>
                  <tbody>
                    <% @engagement_form.volunteer_shifts.ordered_by_date.each do |shift| %>
                      <tr>
                        <td><%= shift.organization_name %></td>
                        <td><%= shift.shift_date.strftime("%B %d, %Y") %></td>
                        <td><%= shift.hours %></td>
                      </tr>
                    <% end %>
                  </tbody>
                </table>
              </div>
              <p><strong>Total Hours:</strong> <%= @engagement_form.volunteer_shifts.sum(&:hours) %></p>
            <% else %>
              <p>No volunteer shifts have been added yet.</p>
            <% end %>
          </div>
        </div>
      </div>
    <% end %>
    
    <% if !@engagement_form.has_job? && !@engagement_form.is_student? && !@engagement_form.enrolled_work_program? && !@engagement_form.volunteers_nonprofit? %>
      <div class="usa-alert usa-alert--warning" role="alert">
        <div class="usa-alert__body">
          <h3 class="usa-alert__heading">No Engagement Activities Selected</h3>
          <p class="usa-alert__text">You indicated that you do not participate in any of the qualifying engagement activities. Please review the Community Engagement Requirements to ensure you meet the necessary criteria.</p>
        </div>
      </div>
    <% end %>
    
    <div class="usa-form-group">
      <%= form_with url: submit_summary_path(@engagement_form), method: :post, local: true do |form| %>
        <%= form.submit "Submit Form", class: "usa-button" %>
      <% end %>
    </div>
  </div>
</div>
