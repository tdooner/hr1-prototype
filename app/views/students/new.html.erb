<div class="grid-row">
  <div class="grid-col-12 usa-prose">
    <h1>Tell us about your school</h1>
    
    <% if @engagement_form.errors.any? %>
      <div class="usa-alert usa-alert--error" role="alert">
        <div class="usa-alert__body">
          <h4 class="usa-alert__heading">Please correct the following errors:</h4>
          <ul class="usa-alert__text">
            <% @engagement_form.errors.full_messages.each do |message| %>
              <li><%= message %></li>
            <% end %>
          </ul>
        </div>
      </div>
    <% end %>
    
    <%= form_with model: @engagement_form, url: students_path, method: :post, local: true, class: "usa-form usa-form--large", builder: UswdsFormBuilder do |form| %>
      <%= hidden_field_tag :from_review, params[:from_review] if params[:from_review] %>
      
      <fieldset class="usa-fieldset">
        <legend>In <strong><%= @engagement_form.prior_month_name %></strong>, what school did you attend?</legend>
        
        <%= form.text_field :school_name, "School Name" %>
        
        <%= form.collection_radio_buttons :enrollment_status, 
            [
              ["half_time_or_more", "Enrolled at least half-time"],
              ["less_than_half_time", "Enrolled less than half-time"]
            ], 
            :first, 
            :last, 
            { label_text: "Enrollment Status" } %>
        
        <div class="usa-form-group" id="school-hours-section" style="display: none;">
          <%= form.number_field :school_hours, "Number of hours you attended school", nil, step: "0.5", min: "0" %>
        </div>
      </fieldset>
      
      <div class="usa-form-group">
        <%= form.submit "Continue", class: "usa-button" %>
      </div>
    <% end %>
  </div>
</div>

<script>
function initializeEnrollmentForm() {
  const halfTimeRadio = document.getElementById('engagement_form_enrollment_status_half_time_or_more');
  const lessThanHalfTimeRadio = document.getElementById('engagement_form_enrollment_status_less_than_half_time');
  const schoolHoursSection = document.getElementById('school-hours-section');
  
  if (!halfTimeRadio || !lessThanHalfTimeRadio || !schoolHoursSection) {
    return; // Elements not found, exit early
  }
  
  function toggleSchoolHours() {
    if (lessThanHalfTimeRadio.checked) {
      schoolHoursSection.style.display = 'block';
    } else {
      schoolHoursSection.style.display = 'none';
    }
  }
  
  // Remove existing event listeners to prevent duplicates
  halfTimeRadio.removeEventListener('change', toggleSchoolHours);
  lessThanHalfTimeRadio.removeEventListener('change', toggleSchoolHours);
  
  // Add event listeners
  halfTimeRadio.addEventListener('change', toggleSchoolHours);
  lessThanHalfTimeRadio.addEventListener('change', toggleSchoolHours);
  
  // Initialize on page load
  toggleSchoolHours();
}

// Listen for both DOMContentLoaded (for initial page load) and turbo:load (for Turbo navigation)
document.addEventListener('DOMContentLoaded', initializeEnrollmentForm);
document.addEventListener('turbo:render', initializeEnrollmentForm);
</script>
